<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Abrir ou Baixar App Prudential</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        margin: 0;
        padding: 0;
      }
      #app-banner {
        display: none;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        border-radius: 12px;
        text-align: center;
        padding: 20px;
        max-width: 340px;
        width: 90%;
        z-index: 9999;
      }
      #app-banner h3 {
        margin: 0 0 10px;
        font-size: 18px;
      }
      #app-banner p {
        font-size: 14px;
        color: #555;
        margin-bottom: 16px;
      }
      #app-banner button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
      }
      #app-banner button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div id="app-banner">
      <h3>Abra o App Prudential</h3>
      <p id="app-text">Acesse sua conta de forma rápida e segura.</p>
      <button id="openOrDownloadBtn">Abrir ou Baixar App</button>
    </div>
    <script>
      (function () {
        const ua = navigator.userAgent || "";
        const isAndroid = /Android/i.test(ua);
        const isIOS = /iPhone|iPad|iPod/i.test(ua);
        const isMobile = isAndroid || isIOS;
        if (!isMobile) return;
        const banner = document.getElementById("app-banner");
        const button = document.getElementById("openOrDownloadBtn");
        const text = document.getElementById("app-text");
        banner.style.display = "block";
        const appScheme = "prudentialapp://open";
        const androidStore =
          "market://details?id=com.prudential.clienteprudential";
        const iosStore =
          "https://apps.apple.com/br/app/prudential-seguros/id6736710765";
        // delays por plataforma (ms)
        const ANDROID_DELAY = 1200;
        const IOS_DELAY = 2500;
        // margem para garantir fallback se página não perdeu foco
        const GRACE_MS = 500;
        button.addEventListener("click", () => {
          const start = Date.now();
          let iframe = null;
          let fallbackTimer = null;
          let opened = false;
          function cleanupListeners() {
            document.removeEventListener("visibilitychange", onVisibility);
            window.removeEventListener("pagehide", onPageHide);
            if (fallbackTimer) {
              clearTimeout(fallbackTimer);
              fallbackTimer = null;
            }
          }
          function onVisibility() {
            if (document.hidden) {
              opened = true;
              cleanupListeners();
            }
          }
          function onPageHide() {
            opened = true;
            cleanupListeners();
          }
          // registra listeners *antes* de tentar abrir
          document.addEventListener("visibilitychange", onVisibility);
          window.addEventListener("pagehide", onPageHide);
          if (isAndroid) {
            // Android: usar iframe (funcionava 100% pra você)
            iframe = document.createElement("iframe");
            iframe.style.display = "none";
            iframe.src = appScheme;
            document.body.appendChild(iframe);
          } else if (isIOS) {
            // iOS: abrir direto via location
            // usar assign ao invés de location.href pode ser equivalente
            window.location.assign(appScheme);
          }
          // escolhe delay adequado
          const delay = isIOS ? IOS_DELAY : ANDROID_DELAY;
          // fallback (executa após 'delay', mas só redireciona se não houve abertura)
          fallbackTimer = setTimeout(() => {
            const elapsed = Date.now() - start;
            // se não houve perda de foco (opened=false) e ainda dentro da janela (elapsed < delay + GRACE_MS), faz fallback
            if (!opened && elapsed < delay + GRACE_MS) {
              // mensagem extra para iOS (opcional)
              if (isIOS) {
                text.textContent =
                  "Se o app estiver instalado, toque em 'Abrir' na App Store.";
              }
              // abrir app da loja (market:// no Android, App Store link no iOS)
              try {
                if (isAndroid) {
                  // via location (navegação na mesma aba) para manter comportamento consistente
                  window.location.href = androidStore;
                } else {
                  window.location.href = iosStore;
                }
              } catch (e) {
                // fallback adicional
                if (isAndroid) {
                  window.open(
                    "https://play.google.com/store/apps/details?id=com.prudential.clienteprudential",
                    "_blank"
                  );
                } else {
                  window.open(iosStore, "_blank");
                }
              }
            }
            cleanupListeners();
            // remove iframe se foi criado
            if (iframe && iframe.parentNode) {
              try {
                iframe.parentNode.removeChild(iframe);
              } catch (e) {}
            }
          }, delay);
        });
      })();
    </script>
  </body>
</html>
